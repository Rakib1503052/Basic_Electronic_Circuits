Version 4
SHEET 1 1072 680
WIRE 64 -64 0 -64
WIRE 224 -64 144 -64
WIRE 560 -64 560 -80
WIRE 560 -64 320 -64
WIRE 272 16 272 0
WIRE 560 80 560 -64
WIRE -240 112 -304 112
WIRE -128 112 -160 112
WIRE 272 128 272 96
WIRE -784 160 -784 112
WIRE -128 160 -128 112
WIRE -96 160 -128 160
WIRE 112 176 -32 176
WIRE 208 176 192 176
WIRE -96 192 -128 192
WIRE -240 224 -288 224
WIRE -128 224 -128 192
WIRE -128 224 -160 224
WIRE -64 224 -64 208
WIRE -128 240 -128 224
WIRE -288 256 -288 224
WIRE -784 272 -784 240
WIRE 272 272 272 224
WIRE 384 272 272 272
WIRE 560 272 560 160
WIRE 560 272 464 272
WIRE 560 288 560 272
WIRE 272 304 272 272
WIRE -288 352 -288 336
WIRE -128 352 -128 320
WIRE -128 352 -288 352
WIRE -128 368 -128 352
FLAG 272 304 0
FLAG -784 272 0
FLAG -784 112 VDD
IOPIN -784 112 Out
FLAG -64 144 VDD
IOPIN -64 144 In
FLAG -304 112 Out-
IOPIN -304 112 In
FLAG -128 368 0
FLAG 0 -64 0
FLAG 560 288 Out-
IOPIN 560 288 Out
FLAG 560 -80 Out+
IOPIN 560 -80 Out
FLAG -64 224 0
SYMBOL pnp 320 0 M270
SYMATTR InstName Q1
SYMATTR Value 2SAR562F3
SYMBOL npn 208 128 R0
SYMATTR InstName Q2
SYMATTR Value 2N3904
SYMBOL res 480 256 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 10m
SYMBOL res 208 160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 100k
SYMBOL voltage -784 144 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 5
SYMBOL res -144 96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 2k
SYMBOL voltage -288 240 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value PULSE(0.1 3.5 0 1n 1n 50m 1 1)
SYMBOL res -144 208 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 99k
SYMBOL res -144 224 R0
SYMATTR InstName R5
SYMATTR Value 1k
SYMBOL voltage 160 -64 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName VSource
SYMATTR Value 24
SYMBOL res 544 64 R0
SYMATTR InstName R6
SYMATTR Value R=IF(time>70m, 1, if(time<30m, 2, 3))
SYMBOL OpAmps\\AD8655 -64 112 R0
SYMATTR InstName U2
SYMBOL res 256 0 R0
SYMATTR InstName R7
SYMATTR Value 100
TEXT 24 360 Left 2 !.tran 100m
TEXT -968 -64 Left 4 ;Constant Current Source\nRef: https://www.ti.com/tool/CIRCUIT060046
TEXT 584 64 Left 2 ;Load
TEXT -576 376 Left 2 ;Control voltage\nOutput current = Voltage of V2
