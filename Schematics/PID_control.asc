Version 4
SHEET 1 1652 1004
WIRE 272 -384 176 -384
WIRE 352 -384 336 -384
WIRE -16 -256 -96 -256
WIRE 176 -256 176 -384
WIRE 176 -256 64 -256
WIRE 256 -256 176 -256
WIRE 352 -256 352 -384
WIRE 352 -256 336 -256
WIRE 432 -256 352 -256
WIRE 592 -256 432 -256
WIRE 736 -256 672 -256
WIRE 224 -160 224 -176
WIRE 176 -144 176 -256
WIRE 192 -144 176 -144
WIRE 352 -128 352 -256
WIRE 352 -128 256 -128
WIRE 192 -112 144 -112
WIRE 144 -96 144 -112
WIRE 224 -80 224 -96
WIRE 144 0 144 -16
WIRE -640 64 -720 64
WIRE -496 64 -560 64
WIRE -400 64 -496 64
WIRE -256 64 -320 64
WIRE 928 80 800 80
WIRE 1040 80 1008 80
WIRE 240 96 176 96
WIRE 352 96 320 96
WIRE -720 112 -720 64
WIRE -944 176 -944 144
WIRE -416 192 -416 176
WIRE -496 208 -496 64
WIRE -448 208 -496 208
WIRE 880 208 880 192
WIRE -256 224 -256 64
WIRE -256 224 -384 224
WIRE -96 224 -96 -256
WIRE -96 224 -256 224
WIRE -16 224 -96 224
WIRE 176 224 176 96
WIRE 176 224 64 224
WIRE 240 224 176 224
WIRE 352 224 352 96
WIRE 352 224 304 224
WIRE 432 224 352 224
WIRE 608 224 432 224
WIRE 736 224 736 -256
WIRE 736 224 688 224
WIRE 800 224 800 80
WIRE 800 224 736 224
WIRE 848 224 800 224
WIRE -720 240 -720 192
WIRE -640 240 -720 240
WIRE -496 240 -560 240
WIRE -448 240 -496 240
WIRE 1040 240 1040 80
WIRE 1040 240 912 240
WIRE 1120 240 1040 240
WIRE 848 256 800 256
WIRE -416 272 -416 256
WIRE -944 288 -944 256
WIRE -944 288 -976 288
WIRE 880 288 880 272
WIRE -944 320 -944 288
WIRE 224 320 224 304
WIRE -496 336 -496 240
WIRE 176 336 176 224
WIRE 192 336 176 336
WIRE 352 352 352 224
WIRE 352 352 256 352
WIRE 800 352 800 256
WIRE 192 368 144 368
WIRE 144 384 144 368
WIRE 224 400 224 384
WIRE -944 432 -944 400
WIRE 144 480 144 464
WIRE 800 480 800 432
WIRE -496 496 -496 416
WIRE 272 592 176 592
WIRE 352 592 336 592
WIRE -96 720 -96 224
WIRE -32 720 -96 720
WIRE 48 720 32 720
WIRE 176 720 176 592
WIRE 176 720 128 720
WIRE 256 720 176 720
WIRE 352 720 352 592
WIRE 352 720 336 720
WIRE 432 720 352 720
WIRE 592 720 432 720
WIRE 736 720 736 224
WIRE 736 720 672 720
WIRE 224 816 224 800
WIRE 176 832 176 720
WIRE 192 832 176 832
WIRE 352 848 352 720
WIRE 352 848 256 848
WIRE 192 864 144 864
WIRE 144 880 144 864
WIRE 224 896 224 880
WIRE 144 976 144 960
FLAG 224 304 Vdd
IOPIN 224 304 In
FLAG 144 480 0
FLAG -976 288 0
FLAG -944 144 Vdd
IOPIN -944 144 Out
FLAG -944 432 Vee
IOPIN -944 432 Out
FLAG 224 400 Vee
IOPIN 224 400 In
FLAG 224 800 Vdd
IOPIN 224 800 In
FLAG 144 976 0
FLAG 224 896 Vee
IOPIN 224 896 In
FLAG 224 -176 Vdd
IOPIN 224 -176 In
FLAG 144 0 0
FLAG 224 -80 Vee
IOPIN 224 -80 In
FLAG -96 -256 P_in
FLAG -96 224 I_in
FLAG -96 720 D_in
FLAG 432 -256 P_out
FLAG 432 224 I_out
FLAG 432 720 D_out
FLAG -416 176 Vdd
IOPIN -416 176 In
FLAG -416 272 Vee
IOPIN -416 272 In
FLAG -496 496 0
FLAG -256 224 Kp.V_e
FLAG -720 240 V_set
IOPIN -720 240 In
FLAG -720 64 V_fb
IOPIN -720 64 In
FLAG 880 192 Vdd
IOPIN 880 192 In
FLAG 880 288 Vee
IOPIN 880 288 In
FLAG 800 480 0
FLAG 1120 240 V_cmd
IOPIN 1120 240 Out
SYMBOL OpAmps\\AD8655 224 288 R0
SYMATTR InstName U1
SYMBOL res 80 208 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 100k
SYMBOL cap 304 208 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 1.6n
SYMBOL voltage -944 160 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 2.5
SYMBOL voltage -944 304 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 2.5
SYMBOL res 336 80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 100Meg
SYMBOL OpAmps\\AD8655 224 784 R0
SYMATTR InstName U2
SYMBOL res 144 704 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 680
SYMBOL cap 32 704 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 68n
SYMBOL res 352 704 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 100k
SYMBOL res 160 368 M0
SYMATTR InstName R10
SYMATTR Value 100k
SYMBOL res 160 864 M0
SYMATTR InstName R13
SYMATTR Value 100k
SYMBOL cap 336 576 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value 33p
SYMBOL OpAmps\\AD8655 224 -192 R0
SYMATTR InstName U3
SYMBOL res 80 -272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 100k
SYMBOL cap 336 -400 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value 430p
SYMBOL res 352 -272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 100k
SYMBOL res 160 -112 M0
SYMATTR InstName R7
SYMATTR Value 100k
SYMBOL OpAmps\\AD8655 -416 160 R0
SYMATTR InstName U4
SYMBOL res -304 48 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 100k
SYMBOL res -544 48 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 10k
SYMBOL res -544 224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL res -480 432 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R4
SYMATTR Value 100k
SYMBOL voltage -720 208 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 28 19 Left 2
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value ""
SYMATTR Value2 AC 1
SYMBOL OpAmps\\AD8655 880 176 R0
SYMATTR InstName U5
SYMBOL res 704 208 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 10k
SYMBOL res 688 -272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 10k
SYMBOL res 688 704 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 10k
SYMBOL res 784 336 R0
SYMATTR InstName R18
SYMATTR Value 10k
SYMBOL res 1024 64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 10k
TEXT 368 288 Left 2 ;Integral\nTi = R8C2 = 0.00016\nunity gain at 1kHz\nI_out = -I_in/Ti.s\nR9 is a leakage resistor needed\nfor DC stability\nRef: https://www.ti.com/tool/CIRCUIT060027
TEXT 368 760 Left 2 ;Derivative\nTd = R12C3 = 0.0068\nunity gain at 23Hz\nD_out = -D_in.Td.s\nR11 is needed for stabiility\nC4 is a noise filter, can be excluded\nRef: https://www.ti.com/tool/CIRCUIT060028
TEXT 368 -200 Left 2 ;Proportional\nUnity gain (gain = R6/R5)\nf_max = 1kHz\nC1 is a noise filter (cutoff = 1/2.pi.R6.C1)
TEXT -1008 600 Left 2 !.ac dec 50 1 1Meg
TEXT -616 -88 Left 2 ;Differential\nV_out = Kp(V_set - V_fb) = Kp.V_e\nKp = gain = R3/R1 = R4/R2\nR1=R2, R3=R4
TEXT 1088 72 Left 2 ;Final Summing amplifier\nUnity gain\nR14 = R15 = R16\nGain = R17/R14 = R17/R15 = R17/R16\nV_out = V_cmd = -Gain(P_out + I_out + D_out)
TEXT -944 -288 Left 4 ;PID control transfer function\nKp(1 + 1/Ti.s + Td.s)
